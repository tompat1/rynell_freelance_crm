{% extends "base.html" %}
{% block content %}
  <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4">
    <div>
      <h1 class="text-2xl font-semibold">Calendar</h1>
      <p class="text-slate-600 dark:text-slate-300">Events + task due dates (tasks appear as üìù).</p>
    </div>
  </div>

  <div class="grid md:grid-cols-3 gap-6 mt-6">
    <div class="card p-4">
      <div class="font-semibold mb-3">Add event</div>
      <form method="post" action="/events" class="space-y-2">
        <input class="border border-slate-200/70 rounded-xl px-3 py-2 text-sm w-full dark:border-slate-700/70" name="title" placeholder="Event title" required/>
        <input class="border border-slate-200/70 rounded-xl px-3 py-2 text-sm w-full dark:border-slate-700/70" name="start" placeholder="Start (YYYY-MM-DDTHH:MM)" required/>
        <input class="border border-slate-200/70 rounded-xl px-3 py-2 text-sm w-full dark:border-slate-700/70" name="end" placeholder="End (optional)"/>
        <select class="border border-slate-200/70 rounded-xl px-3 py-2 text-sm w-full dark:border-slate-700/70" name="project_id">
          <option value="">Link to project</option>
          {% for p in projects %}<option value="{{ p.id }}">{{ p.name }}</option>{% endfor %}
        </select>
        <select class="border border-slate-200/70 rounded-xl px-3 py-2 text-sm w-full dark:border-slate-700/70" name="contact_id">
          <option value="">Link to contact</option>
          {% for c in contacts %}<option value="{{ c.id }}">{{ c.last_name }}, {{ c.first_name }}</option>{% endfor %}
        </select>
        <input class="border border-slate-200/70 rounded-xl px-3 py-2 text-sm w-full dark:border-slate-700/70" name="location" placeholder="Location"/>
        <textarea class="border border-slate-200/70 rounded-xl px-3 py-2 text-sm w-full dark:border-slate-700/70" name="notes" rows="2" placeholder="Notes"></textarea>
        <button class="btn-primary w-full">
          <svg viewBox="0 0 24 24" class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="1.8">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 5v14m-7-7h14" />
          </svg>
          Create
        </button>
      </form>
    </div>

    <div class="md:col-span-2 card p-4">
      <div id="calendar"></div>
    </div>
  </div>

  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var el = document.getElementById('calendar');
      var calendar = new FullCalendar.Calendar(el, {
        initialView: 'dayGridMonth',
        height: 'auto',
        events: '/api/calendar',
        eventDidMount: function(info) {
          const t = info.event.extendedProps.type;
          if (t === 'task') {
            info.el.title = 'Task due';
          }
        }
      });
      calendar.render();
    });
  </script>
{% endblock %}
